# OCR API Setup Guide

## Обзор изменений

Модуль OCR был полностью изолирован в отдельную папку `app/ocr_api/` для обеспечения модульности и простоты сопровождения.

### Что изменилось:

1. **Создан изолированный модуль OCR** в `app/ocr_api/`
2. **Обновлены импорты** в существующем коде для использования нового модуля
3. **Сохранена полная совместимость** со старым интерфейсом
4. **Добавлены новые возможности** и улучшенное API

## Структура нового модуля

```
app/ocr_api/
├── __init__.py          # Публичный API модуля
├── ocr_client.py        # Основной OCR клиент
├── text_extractor.py    # Высокоуровневые функции
├── legacy_wrapper.py    # Обертки для совместимости
├── test_ocr.py         # Тестирование
└── README.md           # Документация
```

## Изменения в существующем коде

### app/utils/announcement_processor.py
```python
# Было:
from app.core.ocr import OCRProcessor

# Стало:
from app.ocr_api.legacy_wrapper import OCRProcessor
```

### app/text_reader.py
```python
# Было:
from app.core.ocr import extract_text_from_image

# Стало:
from app.ocr_api.legacy_wrapper import extract_text_from_image
```

## Преимущества нового модуля

### 1. Полная изоляция
- Весь OCR код теперь находится в отдельном модуле
- Нет прямых зависимостей от других частей приложения
- Легко тестируется и поддерживается

### 2. Расширенная функциональность
- Поддержка множественных OCR движков
- Единая конфигурация для всех методов
- Пакетная обработка изображений
- Генерация описаний изображений (BLIP)

### 3. Улучшенная обработка ошибок
- Graceful fallback между методами
- Подробные сообщения об ошибках
- Health check для всех сервисов

### 4. Производительность
- Ленивая инициализация для экономии памяти
- Оптимизированная предобработка изображений
- Возможность кэширования результатов

## Тестирование

Запустите тесты для проверки работоспособности:

```bash
cd app/ocr_api
python test_ocr.py
```

Тесты проверят:
- ✅ Статус всех OCR сервисов
- ✅ Работу основного клиента
- ✅ Yandex Vision API (если настроен)  
- ✅ Совместимость со старым кодом
- ✅ Высокоуровневые функции

## Миграция (для разработчиков)

### Если вы используете старый код:
```python
# Старый импорт (продолжает работать)
from app.core.ocr import OCRProcessor

# Обновите на:
from app.ocr_api.legacy_wrapper import OCRProcessor
```

### Для нового кода рекомендуется:
```python
# Используйте новое API
from app.ocr_api import OCRClient, OCRConfig, extract_text_from_image

# Создание клиента с настройками
config = OCRConfig(use_yandex=True, language='ru')
client = OCRClient(config)

# Или простое использование
text = await extract_text_from_image('image.jpg', use_yandex=True)
```

## Конфигурация

Убедитесь что в `.env` файле настроены необходимые токены:

```env
# Для Yandex Vision API
YANDEX_IAM_TOKEN=your_token_here
YANDEX_FOLDER_ID=your_folder_id_here
```

## Зависимости

Все зависимости остались прежними. Опционально можно добавить:

```bash
# Для улучшенной функциональности
pip install paddlepaddle paddleocr  # PaddleOCR
pip install transformers torch      # BLIP модель
```

## Удаление старого кода

После успешного тестирования можно удалить старый файл:

```bash
# ОСТОРОЖНО: Удаляйте только после полного тестирования
rm app/core/ocr.py
```

## Поддержка

Для вопросов и проблем:
1. Проверьте документацию в `app/ocr_api/README.md`
2. Запустите тесты `python app/ocr_api/test_ocr.py`
3. Проверьте логи приложения на наличие ошибок OCR

## Совместимость

✅ **Полная обратная совместимость** - существующий код продолжает работать без изменений  
✅ **Все методы сохранены** - `extract_text`, `preprocess_image`, `yandex_ocr`  
✅ **Та же конфигурация** - параметры `lang`, `use_yandex`, `use_paddle` работают как раньше  
✅ **Те же результаты** - выходные данные идентичны старому модулю 