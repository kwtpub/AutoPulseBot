# üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ Storage API

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–æ–¥—É–ª—å `app/storage_api/` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö:

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è
```
app/storage_api/
‚îú‚îÄ‚îÄ __init__.py              # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è
‚îú‚îÄ‚îÄ database_client.py       # HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è Node.js API
‚îú‚îÄ‚îÄ legacy_wrapper.py        # –û–±–µ—Ä—Ç–∫–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ test_storage.py         # –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –º–æ–¥—É–ª—è
‚îî‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–¥–µ
- `app/utils/announcement_processor.py` - –∑–∞–º–µ–Ω–µ–Ω –∏–º–ø–æ—Ä—Ç –Ω–∞ –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å
- `app/db/car.js` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `checkDuplicate`
- `app/db/server.js` - –¥–æ–±–∞–≤–ª–µ–Ω endpoint `GET /api/cars/check-duplicate/:message_id/:channel`

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Node.js —Å–µ—Ä–≤–µ—Ä
```bash
node app/db/server.js
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É API
```bash
# –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
curl http://localhost:3001/api/health

# –ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç
python test_storage_simple.py
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
```bash
python main.py
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç
```bash
python test_storage_simple.py
```

### –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç (–µ—Å–ª–∏ Node.js —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω)
```bash
python app/storage_api/test_storage.py
```

## üìã –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å

### –í —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –∫–æ–¥–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç)
```python
# –°—Ç–∞—Ä—ã–π –∏–º–ø–æ—Ä—Ç –∑–∞–º–µ–Ω–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
from app.storage_api.legacy_wrapper import send_car_to_node, check_duplicate_car

# –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ –∫–∞–∫ —Ä–∞–Ω—å—à–µ
result = send_car_to_node(car_data)
duplicate = check_duplicate_car(message_id, channel_name)
```

### –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–± (–¥–ª—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π)
```python
from app.storage_api.database_client import get_client, save_car_to_db

# –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
client = get_client()
is_healthy = client.health_check()

# –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
success = save_car_to_db(car_data_dict)
```

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –ù–ï –¢–†–û–ì–ê–ô–¢–ï –ú–û–î–£–õ–¨!

–ú–æ–¥—É–ª—å `app/storage_api/` —Å–æ–∑–¥–∞–Ω –∫–∞–∫ **–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞**. 

**–ù–ï –ò–ó–ú–ï–ù–Ø–ô–¢–ï –ö–û–î –í –≠–¢–û–ô –ü–ê–ü–ö–ï** –±–µ–∑ –∫—Ä–∞–π–Ω–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏!

–ú–æ–¥—É–ª—å:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏
- ‚úÖ –í–µ–¥–µ—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ  
- ‚úÖ –ò–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∑–¥–æ—Ä–æ–≤—å—è
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º —á–µ—Ä–µ–∑ legacy_wrapper

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞

–í–∞—à –±–æ—Ç —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Storage API:

1. **–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞** - –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∞
2. **–†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö** - –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–æ–¥—É–ª–µ
3. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - –ø–æ–ª–Ω–∞—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –∏ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–µ

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Node.js —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª
ls -la .env

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å –æ—Ç–ª–∞–¥–∫–æ–π
DEBUG=* node app/db/server.js
```

### Python –º–æ–¥—É–ª—å –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫
ls -la app/storage_api/

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏  
pip install requests
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ PostgreSQL –≤ `.env`
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—É—â–µ–Ω–∞
- API –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–∂–µ –µ—Å–ª–∏ –ë–î –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (graceful degradation)

## üìû –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ:
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å Node.js —Å–µ—Ä–≤–µ—Ä
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ 
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å `/admin`
4. –í—Å–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Storage API

–õ–æ–≥–∏–∫–∞ –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ **–Ω–µ —Ç—Ä–æ–Ω—É—Ç–∞** - –ø—Ä–æ—Å—Ç–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–æ–¥—É–ª–µ! 